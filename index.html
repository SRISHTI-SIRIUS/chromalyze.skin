<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHROMALYZER</title>
    <style>
        :root {
            --cool-primary: #6b8cff;
            --cool-secondary: #a8c4ff;
            --warm-primary: #ff9f4d;
            --warm-secondary: #ffd4a8;
            --neutral-primary: #9e9e9e;
            --neutral-secondary: #d4d4d4;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f8f9fa;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            padding: 30px;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .description {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .input-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }

        .input-options {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .input-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            background-color: #4285f4;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .input-btn:hover {
            background-color: #3367d6;
            transform: translateY(-2px);
        }

        .input-btn.webcam {
            background-color: #34a853;
        }

        .input-btn.webcam:hover {
            background-color: #2d9248;
        }

        .input-btn.reset {
            background-color: #ea4335;
        }

        .input-btn.reset:hover {
            background-color: #d33426;
        }

        .preview-container {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            gap: 30px;
            flex-wrap: wrap;
        }

        .image-preview {
            width: 300px;
            height: 300px;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .placeholder-text {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            background-color: #eee;
            color: #999;
            font-weight: 500;
        }

        .results-section {
            display: none;
            margin-top: 30px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .skin-tone-result {
            text-align: center;
            margin-bottom: 30px;
        }

        .skin-tone-label {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .skin-tone-desc {
            font-size: 18px;
            color: #666;
            margin-bottom: 20px;
        }

        .confidence-meter {
            height: 10px;
            background-color: #eee;
            border-radius: 5px;
            margin: 15px auto;
            max-width: 300px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #4285f4, #34a853);
            transition: width 0.5s ease;
        }

        .favorable-colors {
            text-align: center;
            margin-bottom: 30px;
        }

        .colors-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .colors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .color-card {
            height: 100px;
            border-radius: 10px;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .color-card:hover {
            transform: translateY(-5px);
        }

        .color-name {
            background-color: rgba(255, 255, 255, 0.8);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .tone-info {
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-top: 30px;
            line-height: 1.6;
            color: #555;
        }

        .tone-info h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .tone-info ul {
            padding-left: 20px;
            margin-bottom: 15px;
        }

        .file-input {
            display: none;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: #4285f4;
            animation: spin 1s ease-in-out infinite;
            margin: 0 auto 15px auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .preview-container {
                flex-direction: column;
                align-items: center;
            }
            
            .image-preview {
                width: 250px;
                height: 250px;
            }
            
            .input-options {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>CHROMALYZER</h1>
        <p class="description">
            Upload an image or use your webcam to analyze skin tones and discover color harmonies.
            Our AI identifies undertones (cool, warm, neutral) and suggests personalized color palettes.
        </p>
        
        <div class="input-section">
            <div class="input-options">
                <button class="input-btn" id="uploadBtn">Upload Image</button>
                <button class="input-btn webcam" id="webcamBtn">Use Webcam</button>
                <button class="input-btn reset" id="resetBtn" style="display: none;">Reset</button>
                <input type="file" accept="image/*" class="file-input" id="fileInput">
            </div>
        </div>
        
        <div class="preview-container">
            <div class="image-preview">
                <div class="placeholder-text">
                    No image selected or webcam inactive
                </div>
            </div>
        </div>
        
        <div class="loading">
            <div class="spinner"></div>
            <p>Analyzing colors...</p>
        </div>
        
        <div class="results-section" id="resultsSection">
            <div class="skin-tone-result">
                <div class="skin-tone-label" id="toneLabel">Color Analysis</div>
                <div class="skin-tone-desc" id="toneDesc">Undertone detected</div>
                <div class="confidence-meter">
                    <div class="confidence-fill" id="confidenceBar"></div>
                </div>
            </div>
            
            <div class="favorable-colors">
                <div class="colors-title">Recommended Colors</div>
                <p>These colors will complement your skin tone beautifully</p>
                <div class="colors-grid" id="colorsGrid"></div>
            </div>
            
            <div class="tone-info">
                <h3>About Your Skin Tone</h3>
                <p id="toneInfoText">
                    Based on our analysis, your skin shows an undertone that falls into this category.
                </p>
                <p>For best results:</p>
                <ul id="toneTipsList">
                    <li>Tips will appear here based on your skin tone</li>
                </ul>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0/dist/tf.min.js"></script>
    <script type="text/javascript">
        // Model and UI variables
        let model;
        let webcam;
        let isWebcamActive = false;
        
        // DOM elements
        const uploadBtn = document.getElementById('uploadBtn');
        const webcamBtn = document.getElementById('webcamBtn');
        const resetBtn = document.getElementById('resetBtn');
        const fileInput = document.getElementById('fileInput');
        const previewContainer = document.querySelector('.image-preview');
        const placeholderText = document.querySelector('.placeholder-text');
        const loadingDiv = document.querySelector('.loading');
        const resultsSection = document.getElementById('resultsSection');
        const toneLabel = document.getElementById('toneLabel');
        const toneDesc = document.getElementById('toneDesc');
        const confidenceBar = document.getElementById('confidenceBar');
        const colorsGrid = document.getElementById('colorsGrid');
        const toneInfoText = document.getElementById('toneInfoText');
        const toneTipsList = document.getElementById('toneTipsList');
        
        // Skin tone data
        const skinTones = {
            'cool': {
                label: 'Cool Undertone',
                desc: 'Your skin has blue/pink undertones',
                info: 'Cool undertones typically have veins that appear blue or purple on the inner wrist, and silver jewelry tends to look more flattering than gold. People with cool undertones often burn easily in the sun and may have naturally rosy cheeks.',
                tips: [
                    'Jewel tones like emerald, sapphire, and amethyst will look stunning',
                    'Pastel shades complement your complexion beautifully',
                    'Cool pinks and berry tones enhance your natural glow',
                    'Opt for pure white over off-white or cream',
                    'Silver and platinum jewelry will look best'
                ],
                colors: [
                    {name: 'Cool Navy', hex: '#001f3f'},
                    {name: 'Sapphire', hex: '#0f52ba'},
                    {name: 'Emerald', hex: '#50c878'},
                    {name: 'Amethyst', hex: '#9966cc'},
                    {name: 'Fuchsia', hex: '#ff00ff'},
                    {name: 'Ruby', hex: '#e0115f'},
                    {name: 'Silver', hex: '#c0c0c0'},
                    {name: 'Rose', hex: '#ff66b2'}
                ]
            },
            'warm': {
                label: 'Warm Undertone',
                desc: 'Your skin has golden/yellow undertones',
                info: 'Warm undertones typically have veins that appear green on the inner wrist, and gold jewelry tends to look more flattering than silver. People with warm undertones often tan easily and may appear yellowish in certain lighting.',
                tips: [
                    'Earth tones like terracotta, olive, and mustard will enhance your complexion',
                    'Rich autumnal colors work beautifully with your skin',
                    'Peach and coral tones will brighten your face',
                    'Opt for cream or ivory over pure white',
                    'Gold and rose gold jewelry will look best'
                ],
                colors: [
                    {name: 'Terracotta', hex: '#e2725b'},
                    {name: 'Olive', hex: '#808000'},
                    {name: 'Mustard', hex: '#ffdb58'},
                    {name: 'Coral', hex: '#ff7f50'},
                    {name: 'Gold', hex: '#ffd700'},
                    {name: 'Burnt Orange', hex: '#cc5500'},
                    {name: 'Camel', hex: '#c19a6b'},
                    {name: 'Rust', hex: '#b7410e'}
                ]
            },
            'neutral': {
                label: 'Neutral Undertone',
                desc: 'Your skin has a balance of warm and cool tones',
                info: 'Neutral undertones typically have veins that appear bluish-green on the inner wrist, and both silver and gold jewelry look equally flattering. People with neutral undertones have the most flexibility in color choices as most hues will complement their skin.',
                tips: [
                    'Pretty much all colors look good on you - experiment freely!',
                    'Muted versions of colors often work best',
                    'Dusty pinks and soft blues are particularly flattering',
                    'Both silver and gold jewelry look great',
                    'You can wear both warm and cool colors effectively'
                ],
                colors: [
                    {name: 'Dusty Rose', hex: '#d4a6a6'},
                    {name: 'Mauve', hex: '#e0b0ff'},
                    {name: 'Soft Teal', hex: '#80ced6'},
                    {name: 'Taupe', hex: '#483c32'},
                    {name: 'Moss', hex: '#8a9a5b'},
                    {name: 'Lavender', hex: '#e6e6fa'},
                    {name: 'Rose Gold', hex: '#e0bfb8'},
                    {name: 'Slate Blue', hex: '#6a5acd'}
                ]
            }
        };
        
        // Load Teachable Machine model
        async function init() {
            const modelURL = './model/model.json'; // Local model file
            const metadataURL = './model/metadata.json'; // Local metadata file
            
            try {
                loadingDiv.style.display = 'block';
                
                // Load the model and metadata
                model = await tmImage.load(modelURL, metadataURL);
                
                console.log('Model loaded successfully');
                loadingDiv.style.display = 'none';
                
                // Set up event listeners
                setupEventListeners();
            } catch (error) {
                console.error('Error loading model:', error);
                loadingDiv.style.display = 'none';
                alert('Error loading the model. Please check the console for details.');
            }
        }
        
        // Set up event listeners
        function setupEventListeners() {
            uploadBtn.addEventListener('click', () => {
                fileInput.click();
            });
            
            fileInput.addEventListener('change', (e) => {
                handleImageUpload(e.target.files[0]);
            });
            
            webcamBtn.addEventListener('click', toggleWebcam);
            
            resetBtn.addEventListener('click', resetApp);
        }
        
        // Handle image upload
        async function handleImageUpload(file) {
            if (!file) return;
            
            try {
                // Display the image
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    
                    // Clear previous content
                    previewContainer.innerHTML = '';
                    previewContainer.appendChild(img);
                    
                    // Predict after image is loaded
                    img.onload = () => {
                        predict(img);
                    };
                };
                reader.readAsDataURL(file);
                
                // Show reset button
                resetBtn.style.display = 'block';
                isWebcamActive = false;
            } catch (error) {
                console.error('Error handling image upload:', error);
            }
        }
        
        // Toggle webcam
        async function toggleWebcam() {
            try {
                if (!isWebcamActive) {
                    // Start webcam
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        video: true, 
                        audio: false 
                    });
                    
                    const video = document.createElement('video');
                    video.srcObject = stream;
                    video.autoplay = true;
                    
                    // Clear previous content
                    previewContainer.innerHTML = '';
                    previewContainer.appendChild(video);
                    
                    webcam = video;
                    isWebcamActive = true;
                    resetBtn.style.display = 'block';
                    webcamBtn.textContent = 'Stop Webcam';
                    
                    // Start prediction loop
                    predictLoop();
                } else {
                    // Stop webcam
                    if (webcam && webcam.srcObject) {
                        webcam.srcObject.getTracks().forEach(track => track.stop());
                    }
                    
                    previewContainer.innerHTML = '';
                    previewContainer.appendChild(document.createElement('div'));
                    
                    isWebcamActive = false;
                    webcamBtn.textContent = 'Use Webcam';
                    resetBtn.style.display = 'none';
                    resultsSection.style.display = 'none';
                }
            } catch (error) {
                console.error('Error accessing webcam:', error);
                alert('Could not access the webcam. Please ensure you have granted camera permissions.');
            }
        }
        
        // Prediction loop for webcam
        async function predictLoop() {
            if (isWebcamActive && webcam && model) {
                await predict(webcam);
                window.requestAnimationFrame(predictLoop);
            }
        }
        
        // Predict skin tone
        async function predict(imageElement) {
            if (!model) return;
            
            try {
                loadingDiv.style.display = 'block';
                resultsSection.style.display = 'none';
                
                // Make a prediction
                const prediction = await model.predict(imageElement);
                
                // Format results
                const topResult = prediction[0]; // Assuming the first class is the primary result
                const toneType = topResult.className.toLowerCase(); // 'cool', 'warm', or 'neutral'
                
                // Update UI with results
                updateResults(toneType, topResult.probability);
                
                loadingDiv.style.display = 'none';
                resultsSection.style.display = 'block';
            } catch (error) {
                console.error('Error during prediction:', error);
                loadingDiv.style.display = 'none';
            }
        }
        
        // Update results display
        function updateResults(toneType, confidence) {
            const toneData = skinTones[toneType] || skinTones['neutral'];
            
            // Set basic tone info
            toneLabel.textContent = toneData.label;
            toneDesc.textContent = toneData.desc;
            confidenceBar.style.width = `${confidence * 100}%`;
            
            // Set tone information
            toneInfoText.textContent = toneData.info;
            
            // Clear previous tips
            toneTipsList.innerHTML = '';
            
            // Add new tips
            toneData.tips.forEach(tip => {
                const li = document.createElement('li');
                li.textContent = tip;
                toneTipsList.appendChild(li);
            });
            
            // Clear previous colors
            colorsGrid.innerHTML = '';
            
            // Add recommended colors
            toneData.colors.forEach(color => {
                const colorCard = document.createElement('div');
                colorCard.className = 'color-card';
                colorCard.style.backgroundColor = color.hex;
                
                const colorName = document.createElement('div');
                colorName.className = 'color-name';
                colorName.textContent = color.name;
                
                colorCard.appendChild(colorName);
                colorsGrid.appendChild(colorCard);
            });
        }
        
        // Reset the app
        function resetApp() {
            // Stop webcam if active
            if (isWebcamActive) {
                webcam.srcObject.getTracks().forEach(track => track.stop());
                previewContainer.innerHTML = '';
                previewContainer.appendChild(document.createElement('div'));
                isWebcamActive = false;
                webcamBtn.textContent = 'Use Webcam';
            }
            
            // Reset file input
            fileInput.value = '';
            
            // Hide results
            resultsSection.style.display = 'none';
            
            // Hide reset button
            resetBtn.style.display = 'none';
            
            // Reset preview
            previewContainer.innerHTML = '';
            const placeholder = document.createElement('div');
            placeholder.className = 'placeholder-text';
            placeholder.textContent = 'No image selected or webcam inactive';
            previewContainer.appendChild(placeholder);
        }
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
